version: '3.2'
services:
    # las:
    #     image: sconecuratedimages/kubernetes:las-scone4.2.1
    #     devices:
    #      - "$DEVICE"
    redis:
        image: sconecuratedimages/apps:redis-6-alpine-test-prd
        #image: redis:6.2.6-alpine
        command: sh -c "sleep 5; SCONE_LOG=debug redis-server --port 6379 --protected-mode no"
        # command: sh -c "sleep 5; SCONE_LOG=7 SCONE_LAS_ADDR=las SCONE_CAS_ADDR=$SCONE_CAS_ADDR SCONE_CONFIG_ID=$REDIS_SESSION/redis redis-server"
        # command: redis-server --port 6379
        devices:
         - "/dev/isgx"
        # depends_on:
        #  - las
        ports:
         - "6379"
        environment:
         - SCONE_VERSION=1
    python:
        #image: "$IMAGE"
        # image: python:3.9.12-alpine3.15
        build: .
        devices:
         - "/dev/isgx"
        #command: sh -c "sleep 5; SCONE_LOG=7 SCONE_LAS_ADDR=las SCONE_CAS_ADDR=$SCONE_CAS_ADDR SCONE_CONFIG_ID=$FLASK_SESSION/flask_restapi python3"
        depends_on:
         - redis
        privileged: true
        environment:
         - SCONE_VERSION=1
         - SCONE_ALLOW_DLOPEN=2
        ports:
         - "4996:4996"
        links:
         - redis
